START TRANSACTION;
CREATE TABLE students(
    studentId CHAR(6) NOT NULL,
    name VARCHAR(20) NOT NULL,
    password CHAR(32) NOT NULL,
    eMail VARCHAR(256),

    PRIMARY KEY (studentId)
);
CREATE TABLE classes(
    classId CHAR(7) NOT NULL,
    className VARCHAR(30) NOT NULL,

    PRIMARY KEY (classId)
);
CREATE TABLE comments(
    classId CHAR(7) NOT NULL,
    commentId INT UNSIGNED NOT NULL,
    comment TEXT NOT NULL,
    studentId CHAR(6) NOT NULL,
    good INT DEFAULT 0,
    bad INT DEFAULT 0,
    time DATETIME DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY (classId, commentId),
    FOREIGN KEY (classId) REFERENCES classes(classId),
    FOREIGN KEY (studentId) REFERENCES students(studentId)
);
CREATE TABLE commentReplies (
    classId CHAR(7) NOT NULL,
    commentId INT UNSIGNED NOT NULL,
    commentReplyId INT UNSIGNED NOT NULL,
    comment TEXT NOT NULL,
    studentId CHAR(6) NOT NULL,
    good INT DEFAULT 0,
    bad INT DEFAULT 0,
    time datetime default CURRENT_TIMESTAMP,

    PRIMARY KEY (classId, commentId, commentReplyId),
    FOREIGN KEY (classId) REFERENCES classes(classId),
    FOREIGN KEY (classId, commentId) REFERENCES comments(classId, commentId),
    FOREIGN KEY (studentId) REFERENCES students(studentId)
);
CREATE TABLE pastQuestions(
    classId CHAR(7) NOT NULL,
    year INT UNSIGNED NOT NULL,
    #1：1クオーター、2：2クオーター、3：3クオーター、4：4クオーター
    semester INT UNSIGNED NOT NULL,
    fileId INT NOT NULL,
    fileName VARCHAR(30),

    PRIMARY KEY (classId, year, semester, fileId),
    FOREIGN KEY (classId) REFERENCES classes(classId),
    CHECK (semester BETWEEN 1 AND 4)
);
CREATE TABLE questionBoards(
    classId CHAR(7) NOT NULL,
    year INT UNSIGNED NOT NULL,
    questionBoardId INT NOT NULL,
    studentId CHAR(6) NOT NULL,
    question TEXT NOT NULL,
    time DATETIME DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY (classId, year, questionBoardId),
    FOREIGN KEY (classId) REFERENCES classes(classId)
);
CREATE TABLE questionBoardReplies(
    classId CHAR(7) NOT NULL,
    year INT UNSIGNED NOT NULL,
    questionBoardId INT NOT NULL,
    questionBoardReplyId INT UNSIGNED NOT NULL,
    studentId CHAR(6) NOT NULL,
    reply text NOT NULL,
    time DATETIME DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY (classId, year, questionBoardId, questionBoardReplyId),
    FOREIGN KEY (classId) REFERENCES classes(classId),
    FOREIGN KEY (studentId) REFERENCES students(studentId)
);
INSERT INTO students (studentId, name, password) VALUES ("19T325", "fumiya", "password");
INSERT INTO students (studentId, name, password) VALUES ("19T326", "yamada", "password");
INSERT INTO students (studentId, name, password) VALUES ("19T327", "john", "password");
INSERT INTO classes (classId, className) VALUES ("5005040", "情報数学");
INSERT INTO classes (classId, className) VALUES ("5005071", "データ構造とアルゴリズム");
INSERT INTO classes (classId, className) VALUES ("5005072", "架空授業１");
INSERT INTO classes (classId, className) VALUES ("5005073", "架空授業２");
INSERT INTO classes (classId, className) VALUES ("5005074", "架空授業３");
INSERT INTO comments (classId, commentId, comment, studentId) VALUES ("5005070", 1, "hello", "19T325");
INSERT INTO comments (classId, commentId, comment, studentId) VALUES ("5005070", 2, "hello WORLD", "19T326");
INSERT INTO comments (classId, commentId, comment, studentId) VALUES ("5005071", 1, "hello WORLD", "19T326");
INSERT INTO comments (classId, commentId, comment, studentId) VALUES ("5005071", 2, "hello WORLD foo", "19T327");
INSERT INTO questionBoards (classId, year, questionBoardId, studentId, question) VALUES ("5005070", 2021, 1, "19T325", "this is first question");
INSERT INTO questionBoards (classId, year, questionBoardId, studentId, question) VALUES ("5005070", 2021, 2, "19T326", "this is second question");
INSERT INTO questionBoards (classId, year, questionBoardId, studentId, question) VALUES ("5005071", 2021, 1, "19T325", "this is first question");
COMMIT;


5:20.10.6~3-0~ubuntu-focal
sudo apt-get install docker-ce=5:20.10.6~3-0~ubuntu-focal docker-ce-cli=5:20.10.6~3-0~ubuntu-focal containerd.io